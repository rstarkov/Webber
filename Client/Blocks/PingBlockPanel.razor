@using Microsoft.AspNetCore.SignalR.Client
@using Webber.Client.Models;

@inherits BlockPanelBase<PingBlockDto>

<div class="PingBlockPanel">
    <BlockPanelContainer IsConnected=@IsConnected ValidUntilUtc=@LastUpdate?.ValidUntilUtc>
        <div class="PingContent">
            @if (LastUpdate != null)
            {
                <div>
                    <div style="float: right">@(LastUpdate.Last?.ToString("#,0") ?? "∞") ms</div>
                    <div>Ping</div>
                </div>
                <div class="RecentChart">
                    <BarChart BarCount=24 Data=@LastUpdate.Recent.Select(GetPt) />
                </div>
            }
        </div>
    </BlockPanelContainer>
</div>

@code {
    private BarChart.Pt GetPt(int? value)
    {
        if (value == null)
            return new BarChart.Pt { Value = 1.0, Color = "#ff00ff" };
        return new BarChart.Pt
            {
                Value = BarChart.ScaleY(value.Value, 10, 2000, x => BarChart.ModifiedLog(x, 10)),
                Color = value > 200 ? "#ff0000" : value > 40 ? "#1985f3" : "#08b025",
            };
    }
}